<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>â° ã‚¢ãƒ©ãƒ¼ãƒ ä»˜ããƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; background: #f0f0f0; }
    #clock { font-size: 64px; font-weight: bold; color: #333; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); margin-bottom: 10px; }
    .alarm-setup, #alarmList li { max-width: 400px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .alarm-setup label { font-size: 16px; margin-top: 10px; display: block; }
    .alarm-setup input, .alarm-setup select, .alarm-setup button { width: 100%; font-size: 18px; padding: 10px; margin: 5px 0; box-sizing: border-box; }
    #alarmList { list-style: none; padding: 0; margin-top: 20px; }
    .alarm-popup { position: fixed; top: 30%; left: 50%; transform: translate(-50%, -30%); background-color: #fff; border: 3px solid #f00; border-radius: 12px; padding: 24px; box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); text-align: center; z-index: 9999; }
    .alarm-title { font-size: 1.5em; font-weight: bold; margin-bottom: 12px; }
    .alarm-time { font-size: 2.5em; font-family: 'Courier New', monospace; margin-bottom: 20px; }
    .stop-button { background-color: #ff3b3b; color: white; font-size: 1.4em; padding: 12px 32px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); transition: transform 0.1s ease; }
    .stop-button:hover { transform: scale(1.05); }
  </style>
</head>
<body>
  <h1>â° ã‚¢ãƒ©ãƒ¼ãƒ ä»˜ããƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆ</h1>
  <div id="clock">--:--:--</div>

  <section class="alarm-setup">
    <label for="alarmTime">ğŸ•’ ã‚¢ãƒ©ãƒ¼ãƒ æ™‚åˆ»</label>
    <input type="time" id="alarmTime">
    <label for="alarmLabel">ğŸ“ ã‚¢ãƒ©ãƒ¼ãƒ å</label>
    <input type="text" id="alarmLabel" placeholder="ä¾‹ï¼šè–¬ãƒ»ä¼šè­°ãƒ»ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼">
    <label for="alarmSound">ğŸ”” ã‚¢ãƒ©ãƒ¼ãƒ éŸ³</label>
    <select id="alarmSound"></select>
    <label for="notifyType">ğŸ“¤ é€šçŸ¥æ–¹æ³•</label>
    <select id="notifyType">
      <option value="slack">Slacké€šçŸ¥</option>
      <option value="mail">ãƒ¡ãƒ¼ãƒ«é€šçŸ¥</option>
      <option value="none">é€šçŸ¥ãªã—</option>
    </select>
    <label for="mailAddress">ğŸ“§ å®›å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
    <select id="mailAddress">
      <option value="ep2a2ahg@gmail.com">ep2a2ahg@gmail.com</option>
      <option value="ep2a2ahg@yahoo.co.jp">ep2a2ahg@yahoo.co.jp</option>
      <option value="ep2a2ahg@hotmail.com">ep2a2ahg@hotmail.com</option>
      <option value="ep2a2ahg@outlook.jp">ep2a2ahg@outlook.jp</option>
    </select>
    <button id="addAlarmBtn">è¿½åŠ </button>
  </section>

  <ul id="alarmList"></ul>
  <audio id="alarmAudio" preload="auto" loop></audio>

  <script>
    const MAIL_WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbybP7kL_m9npaYbM4Y9-X7ymfPD4930i015V1aV2OOQ0j8Obx275ZcXe0UQNYaP25g5YA/exec";
    const alarmTimes = [];
    const clockElement = document.getElementById("clock");
    const alarmAudio = document.getElementById("alarmAudio");
    const alarmList = document.getElementById("alarmList");
    const soundSelector = document.getElementById("alarmSound");
    const addAlarmBtn = document.getElementById("addAlarmBtn");

    const baseURL = "./notification-sounds/";
    const sounds = [
      { label: "ğŸšƒ é›»è»Šé€šé1", file: "densha1.mp3" },
      { label: "ğŸšƒ é›»è»Šé€šé2", file: "densha2.mp3" },
      { label: "ğŸšƒ é›»è»Šé€šé3", file: "densha3.mp3" },
      { label: "ğŸ“ é›»è©±ã®ç€ä¿¡éŸ³", file: "denwa.mp3" },
      { label: "ğŸ† èŠ±ç«å¤§ä¼š", file: "hanabi.mp3" },
      { label: "ğŸ•°ï¸ æŒ¯ã‚Šå­æ™‚è¨ˆ", file: "furikodokei.mp3" },
      { label: "ğŸ•°ï¸ æŸ±æ™‚è¨ˆã®é˜", file: "hasiradokei.mp3" },
      { label: "ğŸ•Šï¸ é³©æ™‚è¨ˆ", file: "hatodokei.mp3" },
      { label: "âš ï¸ è­¦å‘ŠéŸ³1", file: "keikoku1.mp3" },
      { label: "âš ï¸ è­¦å‘ŠéŸ³2", file: "keikou2.mp3" },
      { label: "ğŸ”” éˆ´ã‚’é³´ã‚‰ã™", file: "suzuon.mp3" },
      { label: "â° ç›®è¦šã¾ã—æ™‚è¨ˆ", file: "mezamasi.mp3" },
      { label: "ğŸŒ¸ æ˜¥ã®å°å·", file: "harunoogawa.mp3" },
      { label: "ğŸ”• ãƒŸãƒ¥ãƒ¼ãƒˆ", file: "muon.mp3" }
    ];

    sounds.forEach(sound => {
      const option = document.createElement("option");
      option.textContent = sound.label;
      option.value = baseURL + sound.file;
      soundSelector.appendChild(option);
    });

    function updateClock() {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, '0');
      const m = String(now.getMinutes()).padStart(2, '0');
      const s = String(now.getSeconds()).padStart(2, '0');
      clockElement.textContent = `${h}:${m}:${s}`;
      const nowTime = `${h}:${m}:${s}`;
      alarmTimes.forEach(alarm => {
        if (alarm.enabled && !alarm.triggered && alarm.time === nowTime) {
          triggerAlarm(alarm);
          alarm.triggered = true;
        }
        if (alarm.triggered && alarm.time !== nowTime) {
          alarm.triggered = false;
        }
      });
    }

    setInterval(updateClock, 1000);
    updateClock();

    addAlarmBtn.addEventListener("click", () => {
  const timeInput = document.getElementById("alarmTime").value;
  const labelInput = document.getElementById("alarmLabel").value || "ã‚¢ãƒ©ãƒ¼ãƒ ";
  const soundInput = document.getElementById("alarmSound").value;
  const notifyType = document.getElementById("notifyType").value;

  if (!timeInput || !soundInput) {
    alert("æ™‚åˆ»ã¨ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ã‚’é¸æŠã—ã¦ãã ã•ã„");
    return;
  }

  const time = timeInput + ":00";
  const id = Date.now().toString();

  alarmAudio.src = soundInput;
  alarmAudio.play().then(() => {
    alarmAudio.pause();
    alarmAudio.currentTime = 0;
  }).catch(() => console.warn("éŸ³å£°å†ç”Ÿè¨±å¯NG"));

  alarmTimes.push({
    id: id,
    time: time,
    label: labelInput,
    sound: soundInput,
    enabled: true,
    triggered: false,
    soundLabel: soundSelector.options[soundSelector.selectedIndex].text,
    notifyType: notifyType
  });

  renderAlarmList();
});
      
function renderAlarmList() {
  alarmList.innerHTML = "";
  alarmTimes.forEach((alarm, index) => {
    const li = document.createElement("li");
    let icon = "ğŸ”•";
    if (alarm.notifyType === "mail") icon = "ğŸ“§";
    else if (alarm.notifyType === "slack") icon = "ğŸ’¬";
    li.textContent = `${alarm.time.slice(0,5)} ${icon} ${alarm.label} ${alarm.soundLabel}`;
    const deleteBtn = document.createElement("button");
    deleteBtn.textContent = "å‰Šé™¤";
    deleteBtn.style.marginLeft = "10px";
    deleteBtn.onclick = () => {
      alarmTimes.splice(index, 1);
      renderAlarmList();
    };
    li.appendChild(deleteBtn);
    alarmList.appendChild(li);
  });
}

function triggerAlarm(alarm) {
  const notifyType = alarm.notifyType || "none"; // â† alarmã«ä¿å­˜ã•ã‚ŒãŸé€šçŸ¥ã‚¿ã‚¤ãƒ—ã‚’ä½¿ã†
  const mailAddress = document.getElementById("mailAddress").value;

  let icon = "ğŸ”•";
  if (notifyType === "mail") icon = "ğŸ“§";
  else if (notifyType === "slack") icon = "ğŸ’¬";
  const labelWithIcon = `${icon} ${alarm.label}`;

  const popup = document.createElement("div");
  popup.className = "alarm-popup";
  popup.innerHTML = `
    <div class="alarm-title">${labelWithIcon}</div>
    <div class="alarm-time">${alarm.time.slice(0,5)}</div>
    <button class="stop-button">åœæ­¢</button>
  `;
  document.body.appendChild(popup);

  alarmAudio.src = alarm.sound;
  alarmAudio.play();

  if (notifyType !== "none") {
    const payload = {
      type: notifyType,
      label: labelWithIcon,
      time: alarm.time.slice(0,5),
      id: alarm.id
    };
    if (notifyType === "mail") {
      payload.email = mailAddress;
    }

    fetch(MAIL_WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    })
    .then(res => console.log("é€šçŸ¥æˆåŠŸ"))
    .catch(err => console.error("é€šçŸ¥å¤±æ•—", err));
  }

  popup.querySelector(".stop-button").onclick = () => {
    alarmAudio.pause();
    alarmAudio.currentTime = 0;
    popup.remove();
  };
}
</script>